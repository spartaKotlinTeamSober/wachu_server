# OAuth 소셜로그인 후 회원가입 정책의 수정 여부

현재는 OAuth 인증을 하고 나면 우리측 Member로 저장하는 정책을 쓰고 있다.

다만 여기서 OAuth 서비스 제공자의 값에 따라서 우리측 Member 데이터와 불일치하는 부분이 발생하기도 한다.

- 우리 서비스 Member
    - Email (unique, 인증 필요)
    - Nickname (unique)
    - 소셜 로그인 구분을 위해 `Provider`, `ProviderId` column 추가함
- Kakao 로그인
    - Email 미제공 (사업자 등록 후 비즈앱 심사를 진행해야 권한을 열 수 있음)
    - Nickname 제공
- Naver 로그인
    - Email 제공 (정확히는 연락처 이메일, 네이버 이메일을 그대로 주지 않음)
    - Nickname 제공

이를 방지하기 위해 API Request 로 OAuth 측에서 제공해준 정보만 반환하고

이후 FE에서 추가 정보를 받는 회원가입 페이지를 만들 생각이었다.

다만 여기서 Kakao가 **이메일을 제공해주지 않는 점**, Nickname 은 Unique라서 **중복이 생길 수 있음**을 염두에 둬야한다는게 문제가 생긴다.

만약 Kakao 로그인이라서 사용자가 이메일을 설정해줘야 한다면 추가 회원가입 페이지에서 이메일 인증까지 거쳐야하는 상황이고 닉네임이 중복이라면 닉네임도 문제가 된다.

FE에서 추가 정보 회원가입도 받으면 되는 부분이고 API도 설계만 진행하면 되는 부분이지만 정책이 너무 복잡해지고 회원 기능이 딱히 있지도 않은 서비스인데 너무 기능 스코프가 커지게 된다.

PR 리뷰에서 정책 변경없이 가정하고 시나리오를 구성하면 이런 느낌의 코드가 나왔다.

<a href="https://www.notion.so/9d650c6dc21f4d118b4efae479eb9ed9?pvs=21">이메일, 닉네임을 필수로 받아야 하는 경우를 정리한 리뷰</a>

그래서 튜터님과 얘기해본 결과

결론:

- Scope의 대량 축소
    1. FE에서 추가 회원가입 페이지를 아예 사용하지 않게 변경
    2. OAuth 회원가입시 정보가 비어있더라도 즉시 회원가입 진행후 Access token을 발급함
        1. Email, Nickname 은 더 이상 OAuth에서는 필수 값이 아님
        2. 일반 회원가입은 그대로 이메일 인증 필수 + 닉네임 필수를 갖고감
        3. OAuth에선 만약 값이 중복되었거나 받아오지 못했다면 그냥 null로 처리함
            1. Nickname이 null이면 FE에서 `회원{회원ID}` 로 표기함
    3. 회원가입 진행을 위해 ERD의 축소
        1. email, nickname 을 nullable하게 변경함
